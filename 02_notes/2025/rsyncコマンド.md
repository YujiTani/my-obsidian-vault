---
tags:
  - note
  - CLI
  - rsync
  - copy
---
> [!IMPORTANT]
> このテンプレート[[02_note]]の内容（見出しNote）はサンプルです。
> ご自分にとって使いやすいように編集してください。

## note

rsync は非常に柔軟で強力なファイル同期ツールです。

単なるコピーだけでなく、差分コピーや削除、状態の完全な再現まで細かく制御できるため、バックアップやデプロイ、環境間のファイル同期に最適です。

このツールの仕組みやオプションを理解しておくことで、効率的な開発環境の管理が可能になります。

以上が、rsync コマンドの詳細な解説
高速な置き換え転送コマンド、転送先にしかないファイルを削除する
```
rsync -av --delete ../hono-tutorial/src/ ./src/
rsync -av --delete --dry-run ../hono-tutorial/src/ ./src/ # test
```

## 主なオプションの解説

### -a (archive モード)

- 説明:

-a はアーカイブモードを意味し、以下のオプションのショートカットとなっています。

- -r: 再帰的にディレクトリ内の全てのファイル・フォルダをコピー
- -l: シンボリックリンクをそのまま転送
- -p: ファイルのパーミッションを保持
- -t: タイムスタンプを保持
- -g: グループ情報を保持
- -o: オーナー情報を保持
- -D: デバイスファイルと特別なファイルも保持

- 効果:

ソースの構造や属性情報をそのままコピーするため、元の状態と同じ状態が保たれます。

### -v (verbose)

- 説明:

-v は詳細な情報（verbose）を表示するオプションです。

- 効果:

転送中にどのファイルが処理されているかなどの詳細なログがターミナルに表示され、進行状況や発生したエラーを確認できます。

### --delete

- 説明:

デスティネーション（同期先）のディレクトリ内に存在し、ソースには無いファイルやディレクトリを削除します。

- 効果:

ソースとデスティネーションの内容を正確に一致させるため、不要なファイルが残らないようにできます。

注意点: やや危険なオプションで、誤って重要なファイルを削除しないよう、事前に内容を確認してから実行することをおすすめします。

---

## トレーリングスラッシュの意味

rsync で注意すべき点として、ソースパスの末尾にある「/」の有無があります。

例えば：

- rsync -av source/ destination/

→ ソースディレクトリの中身（ファイルとサブディレクトリ）が destination/ にコピーされます。

- rsync -av source destination/

→ ソースディレクトリ自体が destination/ 内にコピーされ、結果として destination/source/ となります。

今回のケースでは、../hono-tutorial/src/ の末尾に「/」があるため、ディレクトリ内の「中身」のみがコピーされます。

---

## rsync のその他の有用なオプション

- -z

転送中にデータを圧縮します。ネットワーク転送時に帯域を節約できます。

- -P

--partial と --progress の組み合わせです。転送の途中経過を表示し、中断した場合に部分的なファイルを保持します。

- --exclude

特定のファイルやディレクトリを同期から除外します。

例: --exclude 'node_modules/' や --exclude '*.log'

- --include

同期に含めるパターンを指定します。--exclude と組み合わせて利用するケースもあります。

- --dry-run

実行前にどのファイルが同期されるかを確認できます。

例: rsync -av --delete --dry-run ../hono-tutorial/src/ ./src/

実際の変更を行わず、シミュレーション結果を表示します。